{% if mode == "individual_yearly_summary" %}
<div class="bg-white p-6 rounded-xl shadow mb-6">
  <h2 class="text-xl font-semibold text-gray-800 mb-4">ðŸ“† Monthly Attendance Summary â€“ {{ student.name }}</h2>
  <p class="text-sm text-gray-700 mb-4">
  {% if grade %}<strong>Grade:</strong> {{ grade.grade_number }} |{% endif %}
  {% if section %}<strong>Section:</strong> {{ section.name }} |{% endif %}
</p>

  <table class="w-full table-auto border text-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="border px-4 py-2">Month</th>
        <th class="border px-4 py-2">Present</th>
        <th class="border px-4 py-2">Absent</th>
        <th class="border px-4 py-2">Late</th>
        <th class="border px-4 py-2">Total</th>
        <th class="border px-4 py-2">Percentage</th>
      </tr>
    </thead>
    {% comment %} <tbody>
      {% for month in monthly_data %}
      <tr>
        <td class="border px-4 py-2">{{ month.month }}</td>
        <td class="border px-4 py-2 text-center">{{ month.present }}</td>
        <td class="border px-4 py-2 text-center">{{ month.absent }}</td>
        <td class="border px-4 py-2 text-center">{{ month.late }}</td>
        <td class="border px-4 py-2 text-center">{{ month.total }}</td>
        <td class="border px-4 py-2 text-center">
          {% if month.percentage != None %}
            {{ month.percentage }}%
          {% else %}
            -
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody> {% endcomment %}
    <tbody>
    {% for month in monthly_data %}
    {% comment %} <tr class="cursor-pointer hover:bg-gray-50 transition" onclick="toggleMonthDetail('{{ month.month }}')">
        <td class="border px-4 py-2 font-medium">{{ month.month }}</td>
        <td class="border px-4 py-2 text-center">{{ month.present }}</td>
        <td class="border px-4 py-2 text-center">{{ month.absent }}</td>
        <td class="border px-4 py-2 text-center">{{ month.late }}</td>
        <td class="border px-4 py-2 text-center">{{ month.total }}</td>
        <td class="border px-4 py-2 text-center">
        {% if month.percentage != None %}
            {{ month.percentage }}%
        {% else %}
            -
        {% endif %}
        </td>
    </tr>

    <!-- Detail rows, initially hidden -->
    <tr id="detail-{{ month.month }}" class="hidden bg-gray-50">
        <td colspan="6" class="border px-4 py-3">
        {% if month.details %}
            <table class="table-auto w-full text-sm">
            <thead>
                <tr class="bg-gray-200">
                <th class="border px-2 py-1">Date</th>
                <th class="border px-2 py-1">Status</th>
                </tr>
            </thead>
            <tbody>
                {% for d in month.details %}
                <tr>
                    <td class="border px-2 py-1">{{ d.date }}</td>
                    <td class="border px-2 py-1">{{ d.status }}</td>
                </tr>
                {% endfor %}
            </tbody>
            </table>
        {% else %}
            <p class="text-gray-500">No daily records available for this month.</p>
        {% endif %}
        </td>
    </tr> {% endcomment %}

    <tr class="hover:bg-gray-50 transition">
  <td class="border px-4 py-2 font-medium">
    <a href="{% url 'attendance_month_detail' student.id month.month %}" class="text-indigo-600 hover:underline">
      {{ month.month }}
    </a>
  </td>
  <td class="border px-4 py-2 text-center">{{ month.present }}</td>
  <td class="border px-4 py-2 text-center">{{ month.absent }}</td>
  <td class="border px-4 py-2 text-center">{{ month.late }}</td>
  <td class="border px-4 py-2 text-center">{{ month.total }}</td>
  <td class="border px-4 py-2 text-center">
    {% if month.percentage != None %}
      {{ month.percentage }}%
    {% else %}
      -
    {% endif %}
  </td>
</tr>

    {% endfor %}
    </tbody>

  </table>
</div>
{% endif %}


{% if mode != "individual_yearly_summary" %}
<div class="bg-white p-6 rounded-xl shadow">
  <h2 class="text-xl font-semibold text-gray-800 mb-4">ðŸ“Š Attendance Report</h2>
   <p class="text-sm text-gray-700 mt-1">
    {% if mode == "class" %}
      <strong>Grade:</strong> {{ grade.grade_number }} |
      <strong>Section:</strong> {{ section.name }} |
    {% elif mode == "individual" %}
    <strong>Student:</strong> {{ student.name }} |
    {% if grade %}<strong>Grade:</strong> {{ grade.grade_number }} |{% endif %}
    {% if section %}<strong>Section:</strong> {{ section.name }} |{% endif %}
    {% endif %}
    <strong>Date Range:</strong> {{ selected_range|title }}
    {% if start_date and end_date %} ({{ start_date }} â€“ {{ end_date }}){% endif %}
  </p>

  <table class="w-full table-auto border text-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="border px-4 py-2">Roll No</th>
        <th class="border px-4 py-2">Name</th>
        <th class="border px-4 py-2">Present</th>
        <th class="border px-4 py-2">Absent</th>
        <th class="border px-4 py-2">Late</th>
        <th class="border px-4 py-2">Total</th>
        <th class="border px-4 py-2">Percentage</th>
      </tr>
    </thead>
    <tbody>
      {% for record in students %}
      <tr>
        <td class="border px-4 py-2">{{ record.student.roll_number }}</td>
        <td class="border px-4 py-2">{{ record.student.name }}</td>
        <td class="border px-4 py-2 text-center">{{ record.present }}</td>
        <td class="border px-4 py-2 text-center">{{ record.absent }}</td>
        <td class="border px-4 py-2 text-center">{{ record.late }}</td>
        <td class="border px-4 py-2 text-center">{{ record.total }}</td>
        <td class="border px-4 py-2 text-center">
          {% if record.total > 0 %}
            {% with record.present|add:record.late as attended %}
              {% widthratio attended record.total 100 %}%
            {% endwith %}
          {% else %}
            -
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="7" class="text-center text-gray-500 py-4">No attendance records found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endif %}

<script>
    function toggleMonthDetail(month) {
    const row = document.getElementById(`detail-${month}`);
    if (row) {
      row.classList.toggle('hidden');
    }
  }
</script>